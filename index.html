<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>우리 반 자기소개</title>
<link href="https://fonts.googleapis.com/css2?family=Jua&display=swap" rel="stylesheet">
<style>
  body {
    font-family: 'Jua', sans-serif;
    background-color: #fff6f0;
    margin: 0;
    padding: 20px;
  }
  h1 {
    text-align: center;
    color: #ff7e7e;
  }
  .form-container {
    background: white;
    padding: 15px;
    border-radius: 15px;
    box-shadow: 0 4px 8px rgba(0,0,0,0.1);
    max-width: 500px;
    margin: 0 auto 20px auto;
  }
  input, textarea, button {
    font-family: 'Jua', sans-serif;
    font-size: 16px;
    width: 100%;
    padding: 8px;
    margin: 5px 0;
    border-radius: 8px;
    border: 1px solid #ccc;
  }
  button {
    background-color: #ffb6b9;
    border: none;
    cursor: pointer;
  }
  button:hover {
    background-color: #ff999c;
  }
  .card-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
    gap: 15px;
  }
  .card {
    background: white;
    border-radius: 15px;
    padding: 15px;
    box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    text-align: center;
  }
  .card img {
    width: 80px;
    height: 80px;
    border-radius: 50%;
    margin-bottom: 10px;
  }
  .card strong {
    display: block;
    margin-bottom: 5px;
    font-size: 18px;
    color: #ff7e7e;
  }
  .buttons {
    margin-top: 10px;
  }
  .buttons button {
    margin-right: 5px;
    padding: 5px 10px;
    font-size: 14px;
  }
</style>
</head>
<body>

<h1>우리 반 자기소개</h1>
<div class="form-container">
  <input type="text" id="name" placeholder="이름" required>
  <input type="text" id="hobby" placeholder="취미" required>
  <input type="text" id="skill" placeholder="특기" required>
  <textarea id="intro" placeholder="간단한 자기소개" required></textarea>
  <button id="submitBtn">올리기</button>
</div>

<div class="card-grid" id="introList"></div>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
  import { getDatabase, ref, push, onValue, update, remove } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js";

  const firebaseConfig = {
    apiKey: "YOUR_API_KEY",
    authDomain: "YOUR_AUTH_DOMAIN",
    databaseURL: "YOUR_DB_URL",
    projectId: "YOUR_PROJECT_ID",
    storageBucket: "YOUR_BUCKET",
    messagingSenderId: "YOUR_SENDER_ID",
    appId: "YOUR_APP_ID"
  };

  const app = initializeApp(firebaseConfig);
  const db = getDatabase(app);
  const introRef = ref(db, "introductions");

  const submitBtn = document.getElementById("submitBtn");
  const nameInput = document.getElementById("name");
  const hobbyInput = document.getElementById("hobby");
  const skillInput = document.getElementById("skill");
  const introInput = document.getElementById("intro");
  const introList = document.getElementById("introList");

  const likedPosts = new Set();
  const savedName = localStorage.getItem("myName");

  if (savedName) {
    nameInput.value = savedName;
  }

  submitBtn.addEventListener("click", () => {
    const name = nameInput.value.trim();
    const hobby = hobbyInput.value.trim();
    const skill = skillInput.value.trim();
    const intro = introInput.value.trim();
    if (!name || !hobby || !skill || !intro) return;

    localStorage.setItem("myName", name);

    const avatarUrl = `https://api.dicebear.com/7.x/bottts/svg?seed=${encodeURIComponent(name)}`;

    push(introRef, {
      name,
      hobby,
      skill,
      intro,
      likes: 0,
      author: name,
      avatar: avatarUrl
    });

    hobbyInput.value = "";
    skillInput.value = "";
    introInput.value = "";
  });

  onValue(introRef, (snapshot) => {
    introList.innerHTML = "";
    snapshot.forEach((childSnapshot) => {
      const data = childSnapshot.val();
      const key = childSnapshot.key;

      const card = document.createElement("div");
      card.className = "card";
      card.innerHTML = `
        <img src="${data.avatar || 'https://api.dicebear.com/7.x/bottts/svg'}" alt="프로필">
        <strong>${data.name}</strong>
        <div>취미: ${data.hobby}</div>
        <div>특기: ${data.skill}</div>
        <div>${data.intro}</div>
        <div class="buttons">
          <button class="likeBtn">👍 ${data.likes}</button>
          <button class="deleteBtn">삭제</button>
        </div>
      `;

      const likeBtn = card.querySelector(".likeBtn");
      likeBtn.addEventListener("click", () => {
        if (likedPosts.has(key)) {
          alert("이미 좋아요를 눌렀어요!");
          return;
        }
        update(ref(db, `introductions/${key}`), { likes: data.likes + 1 });
        likedPosts.add(key);
      });

      const deleteBtn = card.querySelector(".deleteBtn");
      deleteBtn.addEventListener("click", () => {
        const currentUser = localStorage.getItem("myName");
        if (currentUser === data.author) {
          remove(ref(db, `introductions/${key}`));
        } else {
          alert("작성자만 삭제할 수 있습니다.");
        }
      });

      introList.appendChild(card);
    });
  });
</script>

</body>
</html>
