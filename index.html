<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>우리 반 자기소개</title>
<style>
    body {
        font-family: 'Comic Sans MS', cursive;
        background-color: #fff8e7;
        background-image: url('https://cdn.pixabay.com/photo/2016/03/31/19/58/watermelon-1292272_1280.png');
        background-size: 150px;
        background-repeat: repeat;
        padding: 20px;
        text-align: center;
    }
    h1 {
        color: #ff6f61;
    }
    .input-container {
        background: white;
        border-radius: 15px;
        padding: 20px;
        max-width: 400px;
        margin: auto;
        box-shadow: 0px 4px 10px rgba(0,0,0,0.1);
    }
    input, textarea, button {
        width: 90%;
        padding: 10px;
        margin-top: 10px;
        border-radius: 8px;
        border: 1px solid #ccc;
    }
    button {
        background-color: #ffb347;
        color: white;
        font-weight: bold;
        cursor: pointer;
        border: none;
    }
    button:hover {
        background-color: #ff944d;
    }
    .card {
        background: white;
        border-radius: 15px;
        padding: 15px;
        margin: 15px auto;
        max-width: 500px;
        box-shadow: 0px 4px 10px rgba(0,0,0,0.1);
        text-align: left;
    }
    .btn-container {
        display: flex;
        gap: 10px;
        margin-top: 8px;
    }
    .like-btn {
        background-color: #ff6f61;
        color: white;
    }
    .delete-btn {
        background-color: #888;
        color: white;
    }
</style>
</head>
<body>

<h1>📢 우리 반 자기소개</h1>
<div class="input-container">
    <input type="text" id="name" placeholder="이름">
    <input type="text" id="hobby" placeholder="취미">
    <input type="text" id="specialty" placeholder="특기">
    <textarea id="intro" placeholder="간단한 자기소개"></textarea>
    <button onclick="addIntro()">자기소개 올리기</button>
</div>

<div id="introList"></div>

<!-- Firebase -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.17.1/firebase-app.js";
import { getDatabase, ref, push, set, onValue, remove, get, update } from "https://www.gstatic.com/firebasejs/9.17.1/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyCtBTzq6aIgRzWDB2gfG2LBK19Y4TYCj4w",
  authDomain: "summer-memory-bc163.firebaseapp.com",
  databaseURL: "https://summer-memory-bc163-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "summer-memory-bc163",
  storageBucket: "summer-memory-bc163.firebasestorage.app",
  messagingSenderId: "1014179818008",
  appId: "1:1014179818008:web:4570325a33a90582d2b16d"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

let currentUserName = "";

function addIntro() {
    const name = document.getElementById("name").value.trim();
    const hobby = document.getElementById("hobby").value.trim();
    const specialty = document.getElementById("specialty").value.trim();
    const intro = document.getElementById("intro").value.trim();

    if (!name || !intro) {
        alert("이름과 자기소개를 입력해주세요.");
        return;
    }

    currentUserName = name;

    const introRef = push(ref(db, "introductions"));
    set(introRef, {
        name: name,
        hobby: hobby,
        specialty: specialty,
        intro: intro,
        likes: 0,
        likedBy: {},
        author: name
    });

    document.getElementById("name").value = "";
    document.getElementById("hobby").value = "";
    document.getElementById("specialty").value = "";
    document.getElementById("intro").value = "";
}

function renderList() {
    const introRef = ref(db, "introductions");
    onValue(introRef, (snapshot) => {
        const list = document.getElementById("introList");
        list.innerHTML = "";
        snapshot.forEach((child) => {
            const data = child.val();
            const id = child.key;

            const card = document.createElement("div");
            card.className = "card";
            card.innerHTML = `
                <strong>이름:</strong> ${data.name} <br>
                <strong>취미:</strong> ${data.hobby || "없음"} <br>
                <strong>특기:</strong> ${data.specialty || "없음"} <br>
                <strong>자기소개:</strong> ${data.intro} <br>
                <strong>좋아요:</strong> ${data.likes} 👍
            `;

            const btnContainer = document.createElement("div");
            btnContainer.className = "btn-container";

            const likeBtn = document.createElement("button");
            likeBtn.className = "like-btn";
            likeBtn.innerText = "👍 좋아요";
            likeBtn.onclick = () => likeIntro(id, currentUserName);

            const deleteBtn = document.createElement("button");
            deleteBtn.className = "delete-btn";
            deleteBtn.innerText = "삭제";
            deleteBtn.onclick = () => deleteIntro(id, currentUserName);

            btnContainer.appendChild(likeBtn);
            btnContainer.appendChild(deleteBtn);
            card.appendChild(btnContainer);
            list.appendChild(card);
        });
    });
}

function likeIntro(id, userName) {
    const introRef = ref(db, "introductions/" + id);
    get(introRef).then((snapshot) => {
        if (snapshot.exists()) {
            const data = snapshot.val();
            const likedBy = data.likedBy || {};

            if (likedBy[userName]) {
                alert("이미 좋아요를 누르셨습니다!");
                return;
            }

            likedBy[userName] = true;
            update(introRef, {
                likes: (data.likes || 0) + 1,
                likedBy: likedBy
            });
        }
    });
}

function deleteIntro(id, userName) {
    const introRef = ref(db, "introductions/" + id);
    get(introRef).then((snapshot) => {
        if (snapshot.exists()) {
            const data = snapshot.val();
            if (data.author !== userName) {
                alert("작성자만 삭제할 수 있습니다!");
                return;
            }
            remove(introRef);
        }
    });
}

renderList();
</script>

</body>
</html>
